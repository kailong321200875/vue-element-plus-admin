var M=Object.defineProperty;var E=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var k=(i,s,a)=>s in i?M(i,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[s]=a,V=(i,s)=>{for(var a in s||(s={}))N.call(s,a)&&k(i,a,s[a]);if(E)for(var a of E(s))O.call(s,a)&&k(i,a,s[a]);return i};var u=(i,s,a)=>new Promise((d,b)=>{var g=m=>{try{f(a.next(m))}catch(n){b(n)}},C=m=>{try{f(a.throw(m))}catch(n){b(n)}},f=m=>m.done?d(m.value):Promise.resolve(m.value).then(g,C);f((a=a.apply(i,s)).next())});import{F as U}from"./Form-CLuZAwqB.js";import{u as $}from"./useForm-ddPxPGgM.js";import{u as j}from"./useValidator-aWbiMX7P.js";import{i as q,c as G}from"./index-XQEkcq4y.js";import{g as H}from"./index-C7pK8tsp.js";/* empty css                  */import"./IconPicker-Cu-tHVs4.js";/* empty css                        *//* empty css                    *//* empty css               */import{_ as K}from"./AddButtonPermission.vue_vue_type_script_setup_true_lang-CJOqH8iU.js";import{aa as W,ab as v,F as L,p as J,d as x,ag as Q,c as X}from"./element-plus-B-YefleC.js";import{v as Y,r as P,V as _,u as y,M as t,a3 as w,H as I,w as Z,x as ee,y as ae}from"./vue-chunks-COp0tDkU.js";const he=Y({__name:"Write",props:{currentRow:{type:Object,default:()=>null}},setup(i,{expose:s}){const{t:a}=G(),{required:d}=j(),b=i,g=l=>u(this,null,function*(){var o;const e=yield c();p({permissionList:(o=e==null?void 0:e.permissionList)==null?void 0:o.filter(S=>S.value!==l.value)})}),C=l=>u(this,null,function*(){n.value=V({},l)}),f=()=>u(this,null,function*(){var o;const l=yield c(),e=(o=l==null?void 0:l.permissionList)==null?void 0:o.findIndex(S=>S.id===n.value.id);e!==-1&&(l.permissionList[e]=V({},n.value),n.value=null)}),m=P(!1),n=P(null),F=_([{field:"type",label:"菜单类型",component:"RadioButton",value:0,colProps:{span:24},componentProps:{options:[{label:"目录",value:0},{label:"菜单",value:1}],on:{change:l=>u(this,null,function*(){const e=yield c();l===1?(r([{field:"component",path:"componentProps.disabled",value:!1}]),p({component:y(h)})):(r([{field:"component",path:"componentProps.disabled",value:!0}]),e.parentId===void 0?p({component:"#"}):p({component:"##"}))})}}},{field:"parentId",label:"父级菜单",component:"TreeSelect",componentProps:{nodeKey:"id",props:{label:"title",value:"id",children:"children"},highlightCurrent:!0,expandOnClickNode:!1,checkStrictly:!0,checkOnClickNode:!0,clearable:!0,on:{change:l=>u(this,null,function*(){var o;const e=yield c();l&&e.type===0?p({component:"##"}):!l&&e.type===0?p({component:"#"}):e.type===1&&p({component:(o=y(h))!=null?o:""})})}},optionApi:()=>u(this,null,function*(){return(yield H()).data.list||[]})},{field:"meta.title",label:a("menu.menuName"),component:"Input"},{field:"component",label:"组件",component:"Input",value:"#",componentProps:{disabled:!0,placeholder:"#为顶级目录，##为子目录",on:{change:l=>{h.value=l}}}},{field:"name",label:a("menu.name"),component:"Input"},{field:"meta.icon",label:a("menu.icon"),component:"Input"},{field:"path",label:a("menu.path"),component:"Input"},{field:"meta.activeMenu",label:a("menu.activeMenu"),component:"Input"},{field:"status",label:a("menu.status"),component:"Select",componentProps:{options:[{label:a("userDemo.disable"),value:0},{label:a("userDemo.enable"),value:1}]}},{field:"permissionList",label:a("menu.permission"),component:"CheckboxGroup",colProps:{span:24},formItemProps:{slots:{default:l=>t(I,null,[t(q,{class:"m-t-5px",type:"primary",size:"small",onClick:()=>m.value=!0},{default:()=>[w("添加权限")]}),t(W,{data:l==null?void 0:l.permissionList},{default:()=>[t(v,{type:"index",prop:"id"},null),t(v,{prop:"value",label:"Value"},{default:({row:e})=>n.value&&n.value.id===e.id?t(L,{modelValue:n.value.value,"onUpdate:modelValue":o=>n.value.value=o,size:"small"},null):t("span",null,[e.value])}),t(v,{prop:"label",label:"Label"},{default:({row:e})=>n.value&&n.value.id===e.id?t(L,{modelValue:n.value.label,"onUpdate:modelValue":o=>n.value.label=o,size:"small"},null):t(J,{class:"mr-1",key:e.value},{default:()=>[e.label]})}),t(v,{label:"Operations",width:"180"},{default:({row:e})=>n.value&&n.value.id===e.id?t(x,{size:"small",type:"primary",onClick:f},{default:()=>[w("确定")]}):t(I,null,[t(x,{size:"small",type:"primary",onClick:()=>C(e)},{default:()=>[w("编辑")]}),t(Q,{title:"Are you sure to delete this?",onConfirm:()=>g(e)},{reference:()=>t(x,{size:"small",type:"danger"},{default:()=>[w("删除")]})})])})]})])}}},{field:"meta.hidden",label:a("menu.hidden"),component:"Switch"},{field:"meta.alwaysShow",label:a("menu.alwaysShow"),component:"Switch"},{field:"meta.noCache",label:a("menu.noCache"),component:"Switch"},{field:"meta.breadcrumb",label:a("menu.breadcrumb"),component:"Switch"},{field:"meta.affix",label:a("menu.affix"),component:"Switch"},{field:"meta.noTagsView",label:a("menu.noTagsView"),component:"Switch"},{field:"meta.canTo",label:a("menu.canTo"),component:"Switch"}]),T=_({component:[d()],path:[d()],"meta.title":[d()]}),{formRegister:R,formMethods:D}=$(),{setValues:p,getFormData:c,getElFormExpose:z,setSchema:r}=D,B=()=>u(this,null,function*(){const l=yield z();if(yield l==null?void 0:l.validate().catch(o=>{}))return yield c()}),h=P("");Z(()=>b.currentRow,l=>{if(!l)return;const e=X(l);h.value=e.type===1?e.component:"",e.parentId===0?r([{field:"component",path:"componentProps.disabled",value:!0}]):r([{field:"component",path:"componentProps.disabled",value:!1}]),e.type===1?r([{field:"component",path:"componentProps.disabled",value:!1}]):r([{field:"component",path:"componentProps.disabled",value:!0}]),p(e)},{deep:!0,immediate:!0}),s({submit:B});const A=l=>u(this,null,function*(){const e=yield c();p({permissionList:[...(e==null?void 0:e.permissionList)||[],l]})});return(l,e)=>(ee(),ae(I,null,[t(y(U),{rules:T,onRegister:y(R),schema:F},null,8,["rules","onRegister","schema"]),t(K,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=o=>m.value=o),onConfirm:A},null,8,["modelValue"])],64))}});export{he as _};
